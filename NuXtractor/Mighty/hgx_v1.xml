<?xml version="1.0" encoding="utf-8" ?>
<!--
Copyright 2020 Chosen Few Software
This file is part of NuXtractor.

NuXtractor is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

NuXtractor is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with NuXtractor.  If not, see <https://www.gnu.org/licenses/>.
 -->
<type name="hgx_v1">
  <type name="file_header">
    <attr name="unk000" type="u4le" />
    <attr name="string_offset" type="u4le" />
    <attr name="texture_offset" type="u4le" />
    <attr name="unk001" type="u4le" />
    <attr name="unk002" type="u4le" />
    <attr name="model_offset" type="u4le" />
  </type>
  <type name="texture_index">
    <type name="header">
      <attr name="data_offset" type="u4le" />
      <attr name="unk000" type="u4le" />
      <attr name="num_entries" type="u4le" />
    </type>
    <type name="entry">
      <attr name="width" type="u4le" />
      <attr name="height" type="u4le" />
      <attr name="levels" type="u4le" />
      <attr name="type" type="u4le" />
      <attr name="offset" type="u4le" />
    </type>
    <attr name="header" type="header" />
    <attr name="entries" type="entry">
      <repeat>expr</repeat>
      <repeat-expr>
        (int)_self.header.num_entries
      </repeat-expr>
    </attr>
    <attr name="padding">
      <size>
        _self.header.data_offset - _self.header.num_entries * 20
      </size>
    </attr>
    <attr name="textures">
      <size>
        ((_index + 1 > _self.entries.size - 1) ? (_self._parent.main_header.model_offset - (_self._parent.main_header.texture_offset + _self.header.data_offset + 0x0C)) : _self.entries[_index+1].offset) - _self.entries[_index].offset
      </size>
      <repeat>expr</repeat>
      <repeat-expr>
        (int)_self.header.num_entries
      </repeat-expr>
    </attr>
  </type>
  <attr name="main_header" type="file_header" />
  <attr name="texture_index" type="texture_index">
    <offset>
      _self.main_header.texture_offset + 0x30
    </offset>
  </attr>
</type>
